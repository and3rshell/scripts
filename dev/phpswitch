#!/usr/bin/env bash

source config

BIN_DIR="$HOME/.local/bin"
# GROUP="$(id -gn)"

del_old_links() {
    [ -f "$BIN_DIR/php" ] && sudo rm "$BIN_DIR/php"
    [ -f "$BIN_DIR/phpize" ] && sudo rm "$BIN_DIR/phpize"
}

# it's a symlink, won't work this way
# change_ownership() {
#     sudo chown "$USER:$GROUP" "$BIN_DIR/php"
#     sudo chown "$USER:$GROUP" "$BIN_DIR/phpize"
# }

print_info() {
    ls --color=auto -al "$BIN_DIR/php" "$BIN_DIR/phpize"
    echo -e "\nExec zsh to refresh"
}

activate_v74() {
    del_old_links

    sudo ln -sf "/usr/bin/php74" "$BIN_DIR/php" || exit 1
    sudo ln -sf "/usr/bin/phpize74" "$BIN_DIR/phpize" || exit 1

    # change_ownership
    print_info
}

activate_v8() {
    del_old_links

    sudo ln -sf "/usr/bin/php" "$BIN_DIR/php" || exit 1
    sudo ln -sf "/usr/bin/phpize" "$BIN_DIR/phpize" || exit 1

    # change_ownership
    print_info
}

case "$1" in
    "74")
        activate_v74
        ;;
    "8")
        activate_v8
        ;;
esac
